kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.10.1/deploy/static/provider/aws/deploy.yaml


kubectl create configmap tcp-services -n ingress-nginx --from-literal=5432="default/postgres-service:5432"


kubectl patch svc ingress-nginx-controller -n ingress-nginx -p '{
  "metadata": {
    "annotations": {
      "service.beta.kubernetes.io/aws-load-balancer-type": "nlb",
      "service.beta.kubernetes.io/aws-load-balancer-backend-protocol": "tcp",
      "service.beta.kubernetes.io/aws-load-balancer-healthcheck-protocol": "tcp",
      "service.beta.kubernetes.io/aws-load-balancer-healthcheck-port": "80"
    }
  },
  "spec": {
    "ports": [
      {"name": "http","port": 80,"targetPort": 80},
      {"name": "https","port": 443,"targetPort": 443},
      {"name": "postgres","port": 5432,"targetPort": 5432}
    ]
  }
}'


kubectl rollout restart deployment ingress-nginx-controller -n ingress-nginx


kubectl get pods -n ingress-nginx -l app.kubernetes.io/component=controller
kubectl logs -n ingress-nginx -l app.kubernetes.io/component=controller


aws elbv2 describe-target-health --target-group-arn <TARGET_GROUP_ARN>
